<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<title>Apply for Personal Loan - Atyant Loan Solutions</title>
<link rel="icon" href="../assets/logo.png" type="image/png"/>

<!-- Bootstrap & FontAwesome -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>

<!-- Custom CSS -->
<link rel="stylesheet" href="../navbar.css" />
<link rel="stylesheet" href="./apply.css" />
<style>
/* ===== Loader ===== */
#preloader {
  position: fixed;
  top:0;
  left:0;
  width:100%;
  height:100%;
  background:#fff;
  display:flex;
  justify-content:center;
  align-items:center;
  flex-direction:column;
  z-index:9999;
  opacity: 1;
  transition: opacity 0.5s ease;
}
#preloader p {
  margin-top:10px;
  font-size:1rem;
  font-weight:500;
  color:#0d6efd;
}
</style>
</head>
<body>

<!-- Loader -->
<div id="preloader" class="d-flex justify-content-center align-items-center flex-column">
  <div class="spinner-border text-primary" role="status">
    <span class="visually-hidden">Loading...</span>
  </div>
  <p>Loading...</p>
</div>

<!-- Navbar dynamically injected -->
<div id="navbar-container"></div>

<!-- Loan Form -->
<div class="container mt-5 mb-5">
  <h2 class="text-center mb-4 logo-title">📝 Apply for Personal Loan</h2>
  <form id="loanForm" class="p-4 border rounded shadow bg-white">
    <div class="mb-3">
      <label for="name" class="form-label">👤 Full Name</label>
      <input type="text" id="name" class="form-control" placeholder="John Doe" required>
    </div>
    <div class="mb-3">
      <label for="dob" class="form-label">🎂 Date of Birth</label>
      <input type="date" id="dob" class="form-control" required>
    </div>
    <div class="mb-3">
      <label for="email" class="form-label">📧 Email</label>
      <input type="email" id="email" class="form-control" placeholder="example@gmail.com" required>
    </div>
    <div class="mb-3">
      <label for="phone" class="form-label">📞 Phone Number</label>
      <input type="tel" id="phone" class="form-control" pattern="[0-9]{10}" placeholder="9876543210" required>
    </div>
    <div class="mb-3">
      <label for="city" class="form-label">🏙️ City</label>
      <input type="text" id="city" class="form-control" placeholder="Mumbai" required>
    </div>
    <div class="mb-3">
      <label for="pincode" class="form-label">📮 Pincode</label>
      <input type="text" id="pincode" class="form-control" pattern="[0-9]{6}" placeholder="400072" required>
    </div>
    <div class="mb-3">
      <label for="company" class="form-label">🏢 Company Name</label>
      <input type="text" id="company" class="form-control" placeholder="Company Name" required>
    </div>
    <div class="mb-3">
      <label for="loanAmount" class="form-label">💵 Loan Amount (INR)</label>
      <input type="number" id="loanAmount" class="form-control" placeholder="500000" required>
    </div>
    <div class="mb-3">
      <label for="loanTerm" class="form-label">⏳ Loan Term (Years)</label>
      <select id="loanTerm" class="form-control" required>
        <option value="">-- Select Term --</option>
        <option value="1">1 Year</option>
        <option value="2">2 Years</option>
        <option value="3">3 Years</option>
        <option value="4">4 Years</option>
        <option value="5">5 Years</option>
      </select>
    </div>
    <div class="mb-3">
      <label for="employmentStatus" class="form-label">💼 Employment Status</label>
      <select id="employmentStatus" class="form-control" required>
        <option value="">-- Select Status --</option>
        <option value="Employed">Salaried</option>
        <option value="Self-Employed">Self-Employed</option>
        <option value="Unemployed">Unemployed</option>
        <option value="Student">Student</option>
      </select>
    </div>
    <div class="mb-3">
      <label for="monthlyIncome" class="form-label">💰 Monthly Income (INR)</label>
      <input type="number" id="monthlyIncome" class="form-control" placeholder="50000" required>
    </div>
    <div class="mb-3">
      <label for="message" class="form-label">🗒️ Additional Notes</label>
      <textarea id="message" class="form-control" rows="4" placeholder="Any additional info..."></textarea>
    </div>

    <div class="terms-box mb-3">
      <p>
        ✅ By submitting this application, I confirm that the information provided above is true and accurate.  
        I authorize Atyant Loan Solutions and its financial partners to contact me for loan-related information via phone, email, or SMS.  
        I also agree to the <a href="../terms/terms.html" target="_blank">Terms & Conditions</a> and <a href="../privacy/privacy.html" target="_blank">Privacy Policy</a>.
      </p>
      <div class="form-check mt-2">
        <input type="checkbox" class="form-check-input" id="agreeTerms" required>
        <label class="form-check-label" for="agreeTerms">I have read and agree to the Terms & Conditions.</label>
      </div>
    </div>

    <button type="submit" class="btn btn-primary w-100">🚀 Submit Application</button>
    <div id="thankYouMessage" class="alert alert-success mt-3 d-none">
      ✅ Thank you! Your application has been submitted.
    </div>
  </form>
</div>

<!-- Footer dynamically injected -->
<div id="footer-container"></div>

<!-- Scripts -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="../navbar.js"></script>
<script>
  const preloader = document.getElementById("preloader");

  // ===== Page load loader =====
  window.addEventListener("load", () => {
    preloader.style.opacity = "0";
    setTimeout(() => {
      preloader.style.display = "none";
      preloader.style.zIndex = "-1";
    }, 500);
  });

  // ===== Load footer dynamically =====
  function loadFooter() {
    const footerContainer = document.getElementById('footer-container');
    footerContainer.innerHTML = `
      <footer class="bg-dark text-white text-center py-4">
        <div class="container">
          <h5>Atyant Loan Solutions</h5>
          <p>Office No. 406, 4th Floor, Kaveri Building, Near Sakinaka Metro, Andheri East, Mumbai-400072</p>
          <p><strong>Phone:</strong> +91 7304228389 | <strong>Email:</strong> akram.shaikh@atyantloan.com</p>
          <div class="social-icons mb-3">
            <a href="#" target="_blank"><i class="fab fa-facebook-f"></i></a>
            <a href="#" target="_blank"><i class="fab fa-twitter"></i></a>
            <a href="#" target="_blank"><i class="fab fa-linkedin-in"></i></a>
            <a href="https://www.instagram.com/atyantloansolutions/" target="_blank" rel="noopener noreferrer"><i class="fab fa-instagram"></i></a>
          </div>
          <p>&copy; 2025 Atyant Loan Solutions. All Rights Reserved.</p>
        </div>
      </footer>
    `;
  }
  window.addEventListener('DOMContentLoaded', loadFooter);

  // ===== Form submission with loader =====
  const loanForm = document.getElementById("loanForm");
  loanForm.addEventListener("submit", async function(e){
    e.preventDefault();

    if (!document.getElementById("agreeTerms").checked) {
      alert("⚠️ Please agree to the Terms & Conditions before submitting.");
      return;
    }

    // Show loader
    preloader.style.display = "flex";
    preloader.style.opacity = "1";
    preloader.style.zIndex = "9999";

    const data = {
      name: document.getElementById("name").value,
      dob: document.getElementById("dob").value,
      email: document.getElementById("email").value,
      phone: document.getElementById("phone").value,
      city: document.getElementById("city").value,
      pincode: document.getElementById("pincode").value,
      company: document.getElementById("company").value,
      loanAmount: document.getElementById("loanAmount").value,
      loanTerm: document.getElementById("loanTerm").value,
      employmentStatus: document.getElementById("employmentStatus").value,
      monthlyIncome: document.getElementById("monthlyIncome").value,
      message: document.getElementById("message").value,
      termsAccepted: document.getElementById("agreeTerms").checked
    };

    try {
      const res = await fetch("/.netlify/functions/sendEmail", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data)
      });
      const result = await res.json();

      // Hide loader after submission
      preloader.style.opacity = "0";
      setTimeout(() => {
        preloader.style.display = "none";
        preloader.style.zIndex = "-1";
      }, 300);

      if (res.ok && result.success) {
        loanForm.reset();
        document.getElementById("thankYouMessage").classList.remove("d-none");
        alert("✅ Your loan application has been submitted successfully.");
      } else {
        alert("❌ Failed: " + (result.error || result.message));
      }
    } catch(err) {
      preloader.style.opacity = "0";
      setTimeout(() => {
        preloader.style.display = "none";
        preloader.style.zIndex = "-1";
      }, 300);
      console.error(err);
      alert("❌ Failed to send application. Please try again later.");
    }
  });
</script>
</body>
</html>
